<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oil Zone Investment</title>

<script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
<script>
Parse.initialize("eP6iUjmtNrg7SEqtwBkaNLUxtuGEHGk1TYBRz2Ck", "7v1nDUEFTO6WcYFRwjXncGJZOMbahhuLE9KKFMw3");
Parse.serverURL = "https://parseapi.back4app.com/";
</script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#0f9b8e,#38ef7d);
  min-height:100vh;
}
.container{
  max-width:420px;
  margin:30px auto;
  background:#fff;
  border-radius:15px;
  padding:20px;
}
input,button{
  width:100%;
  padding:14px;
  margin:8px 0;
  border-radius:25px;
  border:1px solid #ccc;
}
button{
  border:none;
  background:linear-gradient(to right,#2196f3,#0d47a1);
  color:#fff;
  font-size:16px;
}
.alt{
  background:linear-gradient(to right,#ff9800,#ff5722);
}
section{display:none}
section.active{display:block}
.product{
  border:1px solid #ddd;
  padding:15px;
  margin:10px 0;
  border-radius:12px;
}
.collect.ready{background:#ff9800}
nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:none;
  background:#fff;
  border-top:1px solid #ccc;
}
nav button{
  flex:1;
  background:none;
  color:#000;
}
</style>
</head>

<body>

<div class="container" id="auth">
  <h2>Oil Zone Investment</h2>
  <input id="phone" placeholder="+2547XXXXXXXX">
  <input id="password" type="password" placeholder="Password">
  <input id="confirm" type="password" placeholder="Confirm Password">
  <button class="alt" onclick="register()">Create Account</button>
  <button onclick="login()">Login</button>
</div>

<div class="container section" id="home">
  <h3>Welcome</h3>
  <p>Earn daily for 60 days</p>
</div>

<div class="container section" id="products">
  <h3>Products</h3>
  <div id="productList"></div>
</div>

<div class="container section" id="wallet">
  <h3>Wallet</h3>
  <p>Balance: <b id="balance">KES 0</b></p>
  <button onclick="deposit()">Deposit</button>
  <button onclick="withdraw()">Withdraw</button>
</div>

<div class="container section" id="referral">
  <h3>Referral</h3>
  <p>Your Code: <b id="refCode"></b></p>
</div>

<nav id="nav">
  <button onclick="show('home')">Home</button>
  <button onclick="show('products')">Products</button>
  <button onclick="show('wallet')">Wallet</button>
  <button onclick="show('referral')">Referral</button>
</nav>

<script>
let walletObj;

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

async function register(){
  const user=new Parse.User();
  user.set("username",phone.value.trim());
  user.set("password",password.value.trim());
  user.set("referralCode","OZ"+Math.floor(Math.random()*100000));
  try{
    await user.signUp();
    const Wallet=Parse.Object.extend("Wallet");
    walletObj=new Wallet();
    walletObj.set("user",user);
    walletObj.set("balance",0);
    await walletObj.save();
    alert("Account created");
  }catch(e){alert(e.message)}
}

async function login(){
  try{
    await Parse.User.logIn(phone.value,password.value);
    auth.style.display="none";
    nav.style.display="flex";
    loadWallet();
    show("home");
    generateProducts();
  }catch(e){alert(e.message)}
}

async function loadWallet(){
  const Wallet=Parse.Object.extend("Wallet");
  const q=new Parse.Query(Wallet);
  q.equalTo("user",Parse.User.current());
  walletObj=await q.first();
  balance.innerText="KES "+walletObj.get("balance");
  refCode.innerText=Parse.User.current().get("referralCode");
}

function generateProducts(){
  productList.innerHTML="";
  for(let i=1;i<=6;i++){
    const amount=i*1000;
    const daily=amount*0.1;
    productList.innerHTML+=`
      <div class="product">
        <b>Oil Product ${i}</b>
        <p>Invest: KES ${amount}</p>
        <p>Daily: KES ${daily}</p>
        <button onclick="invest('${i}',${amount})">Invest</button>
        <button class="collect" id="c${i}" onclick="collect('${i}',${daily})">Collect</button>
      </div>`;
  }
}

async function invest(pid,amount){
  if(walletObj.get("balance")<amount) return alert("Insufficient balance");
  walletObj.increment("balance",-amount);
  await walletObj.save();
  const Inv=Parse.Object.extend("Investment");
  const inv=new Inv();
  inv.set("user",Parse.User.current());
  inv.set("productId",pid);
  inv.set("amount",amount);
  inv.set("daysCollected",0);
  inv.set("lastCollected",new Date());
  await inv.save();
  updateBalance();
}

async function collect(pid,daily){
  const Inv=Parse.Object.extend("Investment");
  const q=new Parse.Query(Inv);
  q.equalTo("user",Parse.User.current());
  q.equalTo("productId",pid);
  const list=await q.find();
  let paid=false;
  for(const i of list){
    const h=(Date.now()-i.get("lastCollected").getTime())/3600000;
    if(h>=24 && i.get("daysCollected")<60){
      i.increment("daysCollected",1);
      i.set("lastCollected",new Date());
      await i.save();
      walletObj.increment("balance",daily);
      paid=true;
    }
  }
  if(paid){
    await walletObj.save();
    updateBalance();
    alert("Income collected");
  }else alert("Not ready");
}

function updateBalance(){
  balance.innerText="KES "+walletObj.get("balance");
}

async function deposit(){
  const amt=parseFloat(prompt("Amount"));
  walletObj.increment("balance",amt);
  await walletObj.save();
  updateBalance();
}

async function withdraw(){
  const amt=parseFloat(prompt("Amount"));
  if(amt>walletObj.get("balance")) return alert("Insufficient");
  walletObj.increment("balance",-amt);
  await walletObj.save();
  updateBalance();
  alert("Withdrawal requested");
}
</script>
</body>
</html>